<!DOCTYPE html>
<html>
<head>
    <title>Neon Snake AI</title>
    <style>
        body {
            margin: 0;
            background: radial-gradient(circle at center, #0f0f0f, #000);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            color: #0ff;
        }

        h1 {
            text-shadow: 0 0 15px #0ff;
        }

        canvas {
            background: #000;
            border: 2px solid #0ff;
            box-shadow: 0 0 20px #0ff;
        }

        #info {
            margin-top: 10px;
            text-align: center;
        }

        button {
            margin-top: 10px;
            padding: 6px 15px;
            background: transparent;
            color: #0ff;
            border: 2px solid #0ff;
            cursor: pointer;
        }

        .ai-on {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }
    </style>
</head>
<body>

<h1>üêç Neon Snake AI</h1>
<canvas id="game" width="400" height="400"></canvas>

<div id="info">
    <div id="score">Score: 0</div>
    <div id="highScore">High Score: 0</div>
    <div id="aiStatus">AI: OFF</div>
    <button onclick="restartGame()">Restart</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const box = 20;
let snake, direction, food, score, game;
let speed = 120;
let aiEnabled = false;

let highScore = localStorage.getItem("neonSnakeHighScore") || 0;
document.getElementById("highScore").innerText = "High Score: " + highScore;

function initGame() {
    snake = [{x: 9*box, y: 10*box}];
    direction = "RIGHT";
    food = randomFood();
    score = 0;
    speed = 120;
    document.getElementById("score").innerText = "Score: 0";
}

function randomFood() {
    return {
        x: Math.floor(Math.random()*19)*box,
        y: Math.floor(Math.random()*19)*box
    };
}

document.addEventListener("keydown", function(e) {

    // Toggle AI with ]
    if (e.key === "]") {
        aiEnabled = !aiEnabled;
        document.getElementById("aiStatus").innerText = "AI: " + (aiEnabled ? "ON" : "OFF");
        document.getElementById("aiStatus").className = aiEnabled ? "ai-on" : "";
    }

    if (!aiEnabled) {
        if (e.key==="ArrowLeft" && direction!=="RIGHT") direction="LEFT";
        if (e.key==="ArrowUp" && direction!=="DOWN") direction="UP";
        if (e.key==="ArrowRight" && direction!=="LEFT") direction="RIGHT";
        if (e.key==="ArrowDown" && direction!=="UP") direction="DOWN";
    }
});

function collision(head, array){
    return array.some(seg => seg.x===head.x && seg.y===head.y);
}

/* ==========================
   üß† SIMPLE AI
========================== */
function runAI() {
    let head = snake[0];

    let possibleMoves = [];

    if (direction !== "RIGHT") possibleMoves.push("LEFT");
    if (direction !== "LEFT") possibleMoves.push("RIGHT");
    if (direction !== "DOWN") possibleMoves.push("UP");
    if (direction !== "UP") possibleMoves.push("DOWN");

    // Prefer moving toward food
    if (food.x < head.x && possibleMoves.includes("LEFT")) direction = "LEFT";
    else if (food.x > head.x && possibleMoves.includes("RIGHT")) direction = "RIGHT";
    else if (food.y < head.y && possibleMoves.includes("UP")) direction = "UP";
    else if (food.y > head.y && possibleMoves.includes("DOWN")) direction = "DOWN";

    // Safety check: don't crash
    let next = getNextPosition(direction);
    if (isDanger(next)) {
        for (let move of possibleMoves) {
            let test = getNextPosition(move);
            if (!isDanger(test)) {
                direction = move;
                break;
            }
        }
    }
}

function getNextPosition(dir) {
    let x = snake[0].x;
    let y = snake[0].y;

    if (dir==="LEFT") x-=box;
    if (dir==="RIGHT") x+=box;
    if (dir==="UP") y-=box;
    if (dir==="DOWN") y+=box;

    return {x,y};
}

function isDanger(pos) {
    return (
        pos.x<0 || pos.y<0 ||
        pos.x>=400 || pos.y>=400 ||
        collision(pos, snake)
    );
}

function draw(){
    ctx.fillStyle="#000";
    ctx.fillRect(0,0,400,400);

    if (aiEnabled) runAI();

    snake.forEach((seg,i)=>{
        ctx.fillStyle=i===0?"#0ff":"#00aaaa";
        ctx.fillRect(seg.x,seg.y,box,box);
    });

    ctx.fillStyle="#ff00ff";
    ctx.fillRect(food.x,food.y,box,box);

    let snakeX=snake[0].x;
    let snakeY=snake[0].y;

    if(direction==="LEFT") snakeX-=box;
    if(direction==="RIGHT") snakeX+=box;
    if(direction==="UP") snakeY-=box;
    if(direction==="DOWN") snakeY+=box;

    if(snakeX===food.x && snakeY===food.y){
        score++;
        if(speed>50) speed-=5;
        clearInterval(game);
        game=setInterval(draw,speed);
        document.getElementById("score").innerText="Score: "+score;
        food=randomFood();
    } else {
        snake.pop();
    }

    let newHead={x:snakeX,y:snakeY};

    if(isDanger(newHead)){
        clearInterval(game);

        if(score>highScore){
            highScore=score;
            localStorage.setItem("neonSnakeHighScore",highScore);
            document.getElementById("highScore").innerText="High Score: "+highScore;
        }

        alert("Game Over! Score: "+score);
        return;
    }

    snake.unshift(newHead);
}

function restartGame(){
    clearInterval(game);
    initGame();
    game=setInterval(draw,speed);
}

initGame();
game=setInterval(draw,speed);
</script>

</body>
</html>
