<!DOCTYPE html>
<html>
<head>
    <title>Neon Snake AI</title>
    <style>
        body {
            margin: 0;
            background: radial-gradient(circle at center, #0f0f0f, #000);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            color: #0ff;
        }

        h1 { text-shadow: 0 0 15px #0ff; }

        canvas {
            background: #000;
            border: 2px solid #0ff;
            box-shadow: 0 0 20px #0ff;
        }

        #info {
            margin-top: 10px;
            text-align: center;
        }

        button {
            cursor: pointer;
        }

        .ai-on {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }

        /* ========================
           Game Container & Neon Panel
        ========================= */
        #gameContainer {
            display: flex;
            align-items: flex-start;
            gap: 20px;
            position: relative;
        }

        #speedPanel {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #000;
            border: 2px solid #0ff;
            box-shadow: 0 0 20px #0ff;
            padding: 15px;
            border-radius: 10px;
            font-family: Arial, sans-serif;
        }

        #speedPanel h2 {
            margin: 0 0 10px 0;
            color: #0ff;
            text-shadow: 0 0 10px #0ff;
        }

        #speedPanel button {
            margin: 5px 0;
            width: 80px;
            padding: 6px 0;
            background: transparent;
            color: #0ff;
            border: 2px solid #0ff;
            border-radius: 5px;
            text-shadow: 0 0 5px #0ff;
            transition: all 0.2s;
        }

        #speedPanel button:hover {
            background: #0ff;
            color: #000;
            box-shadow: 0 0 15px #0ff;
        }

        .speed-selected {
            background: #0ff;
            color: #000;
            box-shadow: 0 0 15px #0ff;
        }

        /* ========================
           Game Over Overlay
        ========================= */
        #gameOverOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            color: #ff00ff;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            font-size: 2em;
            display: none; /* hidden by default */
            z-index: 10;
        }

        #gameOverOverlay button {
            margin-top: 20px;
            padding: 10px 20px;
            background: transparent;
            color: #ff00ff;
            border: 2px solid #ff00ff;
            border-radius: 8px;
            font-size: 0.5em;
            cursor: pointer;
            transition: all 0.2s;
        }

        #gameOverOverlay button:hover {
            background: #ff00ff;
            color: #000;
            box-shadow: 0 0 15px #ff00ff;
        }

    </style>
</head>
<body>

<h1>üêç Neon Snake AI</h1>

<!-- Game Canvas + Side Speed Panel -->
<div id="gameContainer">
    <canvas id="game" width="400" height="400"></canvas>
    <div id="speedPanel">
        <h2>Speed</h2>
        <button id="slowBtn">Slow</button>
        <button id="normalBtn" class="speed-selected">Normal</button>
        <button id="fastBtn">Fast</button>
    </div>
</div>

<!-- Info Section -->
<div id="info">
    <div id="score">Score: 0</div>
    <div id="highScore">High Score: 0</div>
    <div id="aiStatus">AI: OFF</div>
    <button onclick="restartGame()">Restart</button>
</div>

<!-- Game Over Overlay -->
<div id="gameOverOverlay">
    <div id="gameOverText">Game Over! Score: 0</div>
    <button onclick="restartGame()">Restart</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const box = 20;
let snake, direction, food, score, game;
let speed = 120; // default speed
let selectedSpeed = speed;
let aiEnabled = false;
let gameStarted = false; // only start moving after keypress

let highScore = localStorage.getItem("neonSnakeHighScore") || 0;
document.getElementById("highScore").innerText = "High Score: " + highScore;

// Speed buttons
document.getElementById("slowBtn").addEventListener("click", () => selectSpeed(200, "slowBtn"));
document.getElementById("normalBtn").addEventListener("click", () => selectSpeed(120, "normalBtn"));
document.getElementById("fastBtn").addEventListener("click", () => selectSpeed(60, "fastBtn"));

function selectSpeed(val, btnId){
    selectedSpeed = val;
    ["slowBtn","normalBtn","fastBtn"].forEach(id => {
        document.getElementById(id).classList.remove("speed-selected");
    });
    document.getElementById(btnId).classList.add("speed-selected");
}

function initGame() {
    snake = [{x: 9*box, y: 10*box}];
    direction = "RIGHT";
    food = randomFood();
    score = 0;
    speed = selectedSpeed; // apply selected speed
    document.getElementById("score").innerText = "Score: 0";
    document.getElementById("gameOverOverlay").style.display = "none"; // hide overlay
    gameStarted = false;

    // Draw the initial snake and food
    draw();
}

function randomFood() {
    return { x: Math.floor(Math.random()*19)*box, y: Math.floor(Math.random()*19)*box };
}

document.addEventListener("keydown", function(e) {
    // Toggle AI with ]
    if (e.key === "]") {
        aiEnabled = !aiEnabled;
        document.getElementById("aiStatus").innerText = "AI: " + (aiEnabled ? "ON" : "OFF");
        document.getElementById("aiStatus").className = aiEnabled ? "ai-on" : "";
    }

    if (!aiEnabled) {
        let validKey = false;
        if (e.key==="ArrowLeft" && direction!=="RIGHT") { direction="LEFT"; validKey=true; }
        if (e.key==="ArrowUp" && direction!=="DOWN") { direction="UP"; validKey=true; }
        if (e.key==="ArrowRight" && direction!=="LEFT") { direction="RIGHT"; validKey=true; }
        if (e.key==="ArrowDown" && direction!=="UP") { direction="DOWN"; validKey=true; }

        // Start the game on first valid keypress
        if (!gameStarted && validKey) {
            gameStarted = true;
            clearInterval(game);
            game = setInterval(draw, speed);
        }
    }
});

function collision(head, array){
    return array.some(seg => seg.x===head.x && seg.y===head.y);
}

/* ==========================
   üß† SIMPLE AI
========================== */
function runAI() {
    let head = snake[0];
    let possibleMoves = [];
    if (direction !== "RIGHT") possibleMoves.push("LEFT");
    if (direction !== "LEFT") possibleMoves.push("RIGHT");
    if (direction !== "DOWN") possibleMoves.push("UP");
    if (direction !== "UP") possibleMoves.push("DOWN");

    // Prefer moving toward food
    if (food.x < head.x && possibleMoves.includes("LEFT")) direction = "LEFT";
    else if (food.x > head.x && possibleMoves.includes("RIGHT")) direction = "RIGHT";
    else if (food.y < head.y && possibleMoves.includes("UP")) direction = "UP";
    else if (food.y > head.y && possibleMoves.includes("DOWN")) direction = "DOWN";

    // Safety check: don't crash
    let next = getNextPosition(direction);
    if (isDanger(next)) {
        for (let move of possibleMoves) {
            let test = getNextPosition(move);
            if (!isDanger(test)) {
                direction = move;
                break;
            }
        }
    }
}

function getNextPosition(dir) {
    let x = snake[0].x;
    let y = snake[0].y;
    if (dir==="LEFT") x-=box;
    if (dir==="RIGHT") x+=box;
    if (dir==="UP") y-=box;
    if (dir==="DOWN") y+=box;
    return {x,y};
}

function isDanger(pos) {
    return (pos.x<0 || pos.y<0 || pos.x>=400 || pos.y>=400 || collision(pos, snake));
}

function draw(){
    ctx.fillStyle="#000";
    ctx.fillRect(0,0,400,400);

    if (aiEnabled && gameStarted) runAI(); // AI only moves after start

    snake.forEach((seg,i)=>{
        ctx.fillStyle=i===0?"#0ff":"#00aaaa";
        ctx.fillRect(seg.x,seg.y,box,box);
    });

    ctx.fillStyle="#ff00ff";
    ctx.fillRect(food.x,food.y,box,box);

    if (!gameStarted) return; // stop movement before first keypress

    let snakeX=snake[0].x;
    let snakeY=snake[0].y;

    if(direction==="LEFT") snakeX-=box;
    if(direction==="RIGHT") snakeX+=box;
    if(direction==="UP") snakeY-=box;
    if(direction==="DOWN") snakeY+=box;

    if(snakeX===food.x && snakeY===food.y){
        score++;
        document.getElementById("score").innerText="Score: "+score;
        clearInterval(game);
        game=setInterval(draw,speed);
        food=randomFood();
    } else { snake.pop(); }

    let newHead={x:snakeX,y:snakeY};

    if(isDanger(newHead)){
        clearInterval(game);
        if(score>highScore){
            highScore=score;
            localStorage.setItem("neonSnakeHighScore",highScore);
            document.getElementById("highScore").innerText="High Score: "+highScore;
        }
        document.getElementById("gameOverText").innerText = "Game Over! Score: " + score;
        document.getElementById("gameOverOverlay").style.display = "flex";
        return;
    }

    snake.unshift(newHead);
}

function restartGame(){
    clearInterval(game);
    initGame();
}

// Initialize the game, snake drawn but not moving
initGame();
</script>

</body>
</html>
